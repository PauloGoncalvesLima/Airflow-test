
version: 2
models:
  - name: users
    description: "A table containing user information, including unique identifiers for each user."
    columns:
      - name: user_id
        description: "The unique identifier for each user."
        tests:
          - unique
          - not_null
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_users
              origin_column: id
      - name: username
        description: "The display name chosen by the user, used for identification within the platform."

      - name: user_email
        description: "The email address associated with the user, used for communication and account management."

      - name: created_at
        description: "The timestamp indicating when the user account was created."

      - name: updated_at
        description: "The timestamp indicating when the user account was last updated."

      - name: last_activity_at
        description: "The timestamp of the user's most recent sign-in, representing their last activity on the platform."

      - name: user_roles
        description: "A JSON array detailing the roles assigned to the user, defining their permissions and access levels within the system."
      
  - name: participatory_processes
    description: "A table containing data on participatory processes, including unique identifiers for each process."
    columns:
      - name: process_id
        description: "The unique identifier for each participatory process."
        tests:
          - unique
          - not_null
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_participatory_processes
              origin_column: id

      - name: process_type
        description: "The type of the participatory process (e.g., 'consultation', 'deliberation')."

      - name: process_slug
        description: "A URL-friendly identifier for the participatory process, used in web addresses."

      - name: process_title
        description: "The title of the participatory process, providing a brief overview of its purpose."

      - name: process_subtitle
        description: "A subtitle for the participatory process, offering additional context or details."

      - name: description
        description: "A detailed description of the participatory process, outlining its objectives and scope."

      - name: short_description
        description: "A concise description of the participatory process, suitable for summaries or previews."

      - name: responsible_area
        description: "The name of the area responsible for managing the participatory process."

      - name: responsible_type
        description: "The type of the responsible area, indicating its role or function within the organization."

      - name: created_at
        description: "The timestamp indicating when the participatory process was created."

      - name: updated_at
        description: "The timestamp indicating when the participatory process was last updated."

      - name: published_at
        description: "The timestamp indicating when the participatory process was published and became active."

      - name: start_date
        description: "The date when the participatory process officially starts."

      - name: end_date
        description: "The date when the participatory process concludes."

      - name: reference
        description: "A reference identifier or code associated with the participatory process for tracking purposes."

      - name: follows_count
        description: "The number of users who are following or have subscribed to updates for the participatory process."
      
  - name: proposals
    description: "A table containing data on proposals within participatory processes."
    columns:
      - name: proposal_id
        description: "The unique identifier for each proposal."
        tests:
          - unique
          - not_null
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_proposals_proposals
              origin_column: id
      - name: process_id
        description: "The identifier linking the proposal to its parent participatory process."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: participatory_processes
              parent_column: process_id
      - name: user_id
        description: "The identifier linking the proposal to the user who created it."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: users
              parent_column: user_id

      - name: participatory_space_type
        description: "The type of participatory space to which the proposal is associated (e.g., 'Decidim::ParticipatoryProcess')."

      - name: author_type
        description: "The type of author who created the proposal, indicating whether it is an individual user, a group, or another entity."

      - name: proposal_status
        description: "The current status of the proposal (e.g., 'draft', 'published', 'closed'), reflecting its stage in the participatory process."

      - name: created_at
        description: "The timestamp indicating when the proposal was created."

      - name: proposal_title
        description: "The title of the proposal in Portuguese (pt-BR), providing a concise overview of its purpose."

      - name: proposal_text
        description: "The detailed textual content of the proposal in Portuguese (pt-BR), explaining its motivations and objectives."

      - name: proposal_scope
        description: "The scope of the proposal in Portuguese (pt-BR), defining the specific area or theme to which the proposal relates."

      - name: proposal_category
        description: "The category of the proposal in Portuguese (pt-BR), classifying it within a predefined thematic structure."

  - name: comments
    description: "A table containing data on comments within participatory processes."
    columns:
      - name: comment_id
        description: "The unique identifier for each comment."
        tests:
          - unique
          - not_null
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_comments_comments
              origin_column: id
              origin_filter: o.decidim_participatory_space_type = 'Decidim::ParticipatoryProcess'
      - name: commented_component_id
        description: "The identifier linking the comment to its parent component (proposal or comment)."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: proposals
              parent_column: proposal_id
              filter: component_type = 'proposal'
          - referential_integrity_test:
              parent_model: comments
              parent_column: comment_id
              filter: component_type = 'comment'
      - name: user_id
        description: "The identifier linking the comment to the user who created it."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: users
              parent_column: user_id
              
      - name: component_type
        description: "The type of component that the comment is associated with (e.g., 'proposal', 'comment')."

      - name: root_component_type
        description: "The root type of the component that the comment is ultimately associated with."

      - name: commented_root_component_id
        description: "The identifier of the root component that the comment is ultimately associated with."

      - name: comment_text
        description: "The text content of the comment in Portuguese (pt-BR)."

      - name: created_at
        description: "The timestamp when the comment was created."

      - name: updated_at
        description: "The timestamp when the comment was last updated."

      - name: deleted_at
        description: "The timestamp when the comment was deleted, if applicable."

  - name: votes
    description: "A table containing data on votes within participatory processes."
    columns:
      - name: original_vote_id
        description: "The identifier linking the vote to its original record in the source system."
        tests:
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_proposals_proposal_votes
              origin_column: id
              filter: m.component_type = 'proposal'
          - column_completeness_test_source:
              source_name: bronze
              source_table: decidim_comments_comment_votes
              origin_column: id
              filter: m.component_type = 'comment'
      - name: vote_id
        description: "The unique identifier for each vote."
        tests:
          - unique
          - not_null
      - name: voted_component_id
        description: "The identifier linking the vote to its parent component (proposal or comment)."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: proposals
              parent_column: proposal_id
              filter: component_type = 'proposal'
          - referential_integrity_test:
              parent_model: comments
              parent_column: comment_id
              filter: component_type = 'comment'
      - name: user_id
        description: "The identifier linking the vote to the user who cast it."
        tests:
          - not_null
          - referential_integrity_test:
              parent_model: users
              parent_column: user_id
      - name: component_type
        description: "O tipo de componente ao qual o voto est√° associado (por exemplo, 'proposal' ou 'comment')."

      - name: created_at
        description: "O timestamp quando o voto foi criado."

  - name: visits
    description: "Uma tabela contendo dados sobre visitas ao site, incluindo informa√ß√µes detalhadas sobre sess√µes de usu√°rios e intera√ß√µes."
    columns:
      - name: process_id
        description: "O identificador √∫nico do processo participativo associado √† visita."

      - name: participatory_process_slug
        description: "O slug (identificador amig√°vel para URLs) do processo participativo associado √† visita."

      - name: proposal_id
        description: "O identificador √∫nico da proposta associada √† visita, se aplic√°vel."

      - name: session_id
        description: "O identificador √∫nico da sess√£o de usu√°rio durante a qual a visita ocorreu."

      - name: visit_ip
        description: "O endere√ßo IP do visitante durante a sess√£o."

      - name: visitor_id
        description: "Um identificador an√¥nimo √∫nico para o visitante."

      - name: goal_conversions
        description: "O n√∫mero de convers√µes de objetivos durante a visita."

      - name: session_date
        description: "A data da sess√£o de visita."

      - name: visit_server_hour
        description: "A hora do dia (tempo do servidor) em que a visita ocorreu."

      - name: last_action_timestamp
        description: "O timestamp da √∫ltima a√ß√£o na sess√£o de visita."

      - name: last_action_date_time
        description: "A data e hora da √∫ltima a√ß√£o na sess√£o de visita."

      - name: server_timestamp
        description: "O timestamp registrado pelo servidor para a visita."

      - name: first_action_timestamp
        description: "O timestamp da primeira a√ß√£o na sess√£o de visita."

      - name: user_id
        description: "O identificador do usu√°rio logado, se dispon√≠vel."

      - name: visitor_type
        description: "O tipo de visitante, por exemplo, 'novo' ou 'recorrente'."

      - name: visit_converted
        description: "Um booleano indicando se a visita resultou em uma convers√£o."

      - name: visit_count
        description: "O n√∫mero total de visitas feitas pelo visitante."

      - name: days_since_first_visit
        description: "O n√∫mero de dias desde a primeira visita do visitante."

      - name: seconds_since_first_visit
        description: "O n√∫mero de segundos desde a primeira visita do visitante."

      - name: visit_duration_seconds
        description: "A dura√ß√£o da visita em segundos."

      - name: searches
        description: "O n√∫mero de pesquisas realizadas durante a visita."

      - name: events
        description: "O n√∫mero de eventos registrados durante a visita."

      - name: continent
        description: "O continente de onde a visita se originou."

      - name: continent_code
        description: "O c√≥digo representando o continente de onde a visita se originou."

      - name: country
        description: "O pa√≠s de onde a visita se originou."

      - name: country_code
        description: "O c√≥digo representando o pa√≠s de onde a visita se originou."

      - name: region
        description: "A regi√£o ou estado de onde a visita se originou."

      - name: device_type
        description: "O tipo de dispositivo usado durante a visita, por exemplo, 'desktop', 'tablet', 'mobile'."

      - name: region_code
        description: "O c√≥digo representando a regi√£o de onde a visita se originou."

      - name: city
        description: "A cidade de onde a visita se originou."

      - name: location
        description: "A localiza√ß√£o geogr√°fica do visitante."

      - name: visit_local_hour
        description: "A hora local do visitante no momento da visita."

      - name: days_since_last_visit
        description: "O n√∫mero de dias desde a √∫ltima visita do visitante."

      - name: seconds_since_last_visit
        description: "O n√∫mero de segundos desde a √∫ltima visita do visitante."

      - name: resolution
        description: "A resolu√ß√£o da tela do dispositivo usado durante a visita."

      - name: num_actions
        description: "O n√∫mero total de a√ß√µes (visualiza√ß√µes de p√°gina, eventos) durante a visita."

      - name: referrer_type
        description: "O tipo de referenciador, por exemplo, 'motor de busca', 'site', 'direto'."

      - name: referrer_type_name
        description: "Um nome descritivo para o tipo de referenciador."

      - name: referrer_name
        description: "O nome do referenciador, por exemplo, 'Google', 'Facebook'."

      - name: referrer_url
        description: "A URL do referenciador."

      - name: type
        description: "O tipo de a√ß√£o, por exemplo, 'visualiza√ß√£o de p√°gina', 'evento'."

      - name: url
        description: "A URL visitada durante a a√ß√£o."

      - name: page_title
        description: "O t√≠tulo da p√°gina visitada."

      - name: visit_id
        description: "O identificador da a√ß√£o de visita."

      - name: id_page_view
        description: "O identificador √∫nico da visualiza√ß√£o de p√°gina."

      - name: server_time_pretty
        description: "Uma string formatada do tempo do servidor durante a a√ß√£o."

      - name: page_id
        description: "O identificador da p√°gina."

      - name: bandwidth
        description: "A largura de banda usada durante a a√ß√£o."

      - name: time_spent
        description: "O tempo gasto na p√°gina em segundos."

      - name: time_spent_pretty
        description: "Uma string formatada do tempo gasto na p√°gina."

      - name: page_view_position
        description: "A posi√ß√£o da visualiza√ß√£o de p√°gina dentro da visita."

      - name: title
        description: "O t√≠tulo associado √† a√ß√£o."

      - name: subtitle
        description: "O subt√≠tulo associado √† a√ß√£o."

      - name: visit_timestamp
        description: "O timestamp da a√ß√£o de visita."

      - name: bandwidth_pretty
        description: "Uma string formatada da largura de banda usada."

  - name: datas
    description: "Tabela de datas com a flag de feriado nacional e suas informa√ß√µes detalhadas."
    columns:
      - name: ano_mes_dia
        description: "Data no formato YYYYMMDD."
        tests:
          - not_null
          - unique
      - name: ano_mes
        description: "Data no formato YYYYMM."
        tests:
          - not_null
      - name: ano
        description: "Ano da data."
        tests:
          - not_null
      - name: descricao_dia_semana
        description: "Descri√ß√£o textual do dia da semana (ex: Segunda-feira)."
        tests:
          - not_null
      - name: descricao_mes
        description: "Descri√ß√£o textual do m√™s (ex: Janeiro)."
        tests:
          - not_null
      - name: numero_mes
        description: "N√∫mero do m√™s no ano (ex: 1 para Janeiro)."
        tests:
          - not_null
      - name: numero_dia_mes
        description: "N√∫mero do dia no m√™s."
        tests:
          - not_null
      - name: numero_dia_semana
        description: "N√∫mero do dia na semana."
        tests:
          - not_null
      - name: numero_dia_ano
        description: "N√∫mero do dia no ano."
        tests:
          - not_null
      - name: numero_semana_mes
        description: "N√∫mero da semana no m√™s."
        tests:
          - not_null
      - name: final_de_semana
        description: "Flag indicando se a data √© um final de semana (1 para sim, 0 para n√£o)."
        tests:
          - not_null
      - name: numero_semana_ano
        description: "N√∫mero da semana no ano."
        tests:
          - not_null
      - name: flag_feriado
        description: "Flag indicando se a data √© um feriado nacional (1 para sim, 0 para n√£o)."
        tests:
          - not_null
      - name: feriado_nacional
        description: "Nome do feriado nacional, caso seja feriado."
        tests: []

